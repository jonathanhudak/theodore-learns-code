<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stop Motion App</title>
    <style>
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: aqua;
      }
      button {
        background-color: blue;
        color: white;
      }
      #deleteCurrentFrame {
        background-color: red;
      }
      canvas {
        border: 15px solid black;
      }

      video {
        display: none; /* Hide video element */
      }
    </style>
  </head>
  <body>
    <h1>Stop Motion Animation</h1>
    <video id="video" width="640" height="480" autoplay></video>
    <canvas id="canvas" width="640" height="480"></canvas>
    <button id="capture">Capture Frame</button>
    <button id="play">Play Animation</button>
    <button id="deleteCurrentFrame">delete current frame</button>
    <select id="filter">
      <option value="none">None</option>
      <option value="grayscale">Grayscale</option>
      <option value="sepia">Sepia</option>
    </select>
    <script>
      const video = document.getElementById("video");
      const canvas = document.getElementById("canvas");
      const context = canvas.getContext("2d");
      const captureButton = document.getElementById("capture");
      const playButton = document.getElementById("play");
      const filterSelect = document.getElementById("filter");
      const deleteCurrentFrameButton =
        document.getElementById("deleteCurrentFrame");

      let frames = [];

      // Access the camera
      navigator.mediaDevices
        .getUserMedia({
          video: {
            facingMode: "user",
          },
        })
        .then((stream) => {
          video.srcObject = stream;
        })
        .catch((err) => {
          console.error("Error accessing camera: ", err);
        });

      // Capture frame
      captureButton.addEventListener("click", () => {
        context.drawImage(video, 0, 0);
        const frame = canvas.toDataURL("image/png");
        frames.push(frame);
        applyFilter();
      });

      // Apply selected filter
      function applyFilter() {
        const filter = filterSelect.value;
        context.filter = filter === "none" ? "none" : filter + "(100%)";
        context.drawImage(video, 0, 0);
      }

      // delete current frame
      deleteCurrentFrameButton.addEventListener("click", () => {
        frames.pop();
        context.clearRect(0, 0, canvas.width, canvas.height);
      });

      // Play animation
      playButton.addEventListener("click", () => {
        let index = 0;
        const playInterval = setInterval(() => {
          if (index >= frames.length) {
            clearInterval(playInterval);
            return;
          }
          const img = new Image();
          img.src = frames[index];
          img.onload = () => {
            context.clearRect(0, 0, canvas.width, canvas.height);
            context.drawImage(img, 0, 0);
          };
          index++;
        }, 100); // Adjust frame rate here
      });
    </script>
  </body>
</html>
